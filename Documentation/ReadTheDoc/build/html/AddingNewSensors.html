

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adding New Sensors &mdash; OpenExo Documentation 0.1-dev documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=4f578d93"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Adding New UART Messages" href="AddingNewUARTMessage.html" />
    <link rel="prev" title="Adding a New Motor Type" href="AddingNewMotorType.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            OpenExo Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="BuildAndFlash.html">Build And Flash</a><ul>
<li class="toctree-l3"><a class="reference internal" href="BuildAndFlash.html#downloads">Downloads</a></li>
<li class="toctree-l3"><a class="reference internal" href="BuildAndFlash.html#flashing">Flashing</a></li>
<li class="toctree-l3"><a class="reference internal" href="BuildAndFlash.html#libraries">Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="BuildAndFlash.html#arduino-boards-manager">Arduino Boards Manager</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="another_sub_page.html">Sub Tree</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="addingelements.html">Adding Elements</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="AddingNewBLEMessage.html">Adding a New BLE Message</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AddingNewBLEMessage.html#ble-commands-h">ble_commands.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewBLEMessage.html#comsmcu-cpp">ComsMCU.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewBLEMessage.html#done">Done</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewBoard.html">Adding a New Board</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AddingNewBoard.html#config-h">Config.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewBoard.html#parseini-h">ParseIni.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewBoard.html#board-h">Board.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewBoard.html#done">Done!!</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewCanMotor.html">Adding a New CAN Motor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AddingNewCanMotor.html#config-ini">config.ini</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewCanMotor.html#parseini-h">parseIni.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewCanMotor.html#motor-h">Motor.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewCanMotor.html#motor-cpp">Motor.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewCanMotor.html#joint-cpp">Joint.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewCanMotor.html#done">Done</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewController.html">Adding a New Controller</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#parseini-h">parseIni.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#controllerdata-h-controller-definition">ControllerData.h (Controller Definition)</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#controller-h">Controller.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#controllerdata-h-optional-additional-data">ControllerData.h (Optional Additional Data)</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#controller-cpp">Controller.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#joint-h">Joint.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#joint-cpp">Joint.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#create-parameter-file">Create Parameter File</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#paramsfromsd-h">ParamsFromSD.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#uart-commands-h">uart_commands.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewController.html#done">Done</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewErrorCase.html">Adding a New Error Case</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AddingNewErrorCase.html#error-codes-h">error_codes.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewErrorCase.html#error-types-h">error_types.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewErrorCase.html#error-map-h">error_map.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewErrorCase.html#done">Done</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewItemToConfig.html">Adding New Item to Config</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AddingNewItemToConfig.html#config-ini">config.ini</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewItemToConfig.html#parseini-h">ParseIni.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewItemToConfig.html#parseini-cpp">ParseIni.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewItemToConfig.html#uart-commands-h">uart_commands.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewItemToConfig.html#wrap-up">Wrap up</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewJoint.html">Adding a New Joint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#exocode-ini">Exocode.ini</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#parseini-h">ParseIni.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#parseini-cpp">ParseIni.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#exodata-h">ExoData.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#exodata-cpp">ExoData.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#uart-commands-h">UART_commands.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#side-h">Side.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#side-cpp">Side.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#sidedata-h">SideData.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#sidedata-cpp">SideData.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#joint-h">Joint.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#joint-cpp">Joint.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#jointdata-cpp">JointData.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#motor-cpp">Motor.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#motordata-cpp">MotorData.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#controllerdata-cpp">ControllerData.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#controller-cpp">Controller.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#ble-commands-h">ble_commands.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#paramsfromsd-h">ParamsfromSD.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#paramsfromsd-cpp">ParamsfromSD.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#realtimei2c-h">RealTimeI2C.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#statusdefs-h">StatusDefs.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#statusdefs-cpp">StatusDefs.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#statusled-h">StatusLED.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#config-ini">Config.ini</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#sd-card">SD Card</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#python-gui-activetrialsettings-py">Python GUI - ActiveTrialSettings.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#python-gui-exodevicemanager-py">Python GUI - exoDeviceManager.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewJoint.html#done">Done</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewMicrocontroller.html">Adding a New Microcontroller</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AddingNewMicrocontroller.html#selecting-microcontroller">Selecting Microcontroller</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewMicrocontroller.html#design-board">Design Board</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewMicrocontroller.html#board-h">Board.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewMicrocontroller.html#config-ini">config.ini</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewMicrocontroller.html#parseini-h">ParseIni.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewMicrocontroller.html#other-files">Other Files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewMotorType.html">Adding a New Motor Type</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AddingNewMotorType.html#motor-h">Motor.h</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewMotorType.html#motor-cpp">Motor.cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewMotorType.html#connect-to-everything-else">Connect to Everything Else</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adding New Sensors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analog-input">Analog Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bus-protocols">Bus Protocols</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integrating-new-sensors-into-the-codebase">Integrating New Sensors into the Codebase</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewUARTMessage.html">Adding New UART Messages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="AddingNewUARTMessage.html#messaging-structure">Messaging Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewUARTMessage.html#declare-message-id-s">Declare Message ID(s)</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewUARTMessage.html#declare-message-handler">Declare Message Handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewUARTMessage.html#add-your-function-to-the-list-of-callable-functions">Add Your Function to the List of Callable Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="AddingNewUARTMessage.html#done">Done</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenExo Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="addingelements.html">Adding Elements</a></li>
      <li class="breadcrumb-item active">Adding New Sensors</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/AddingNewSensors.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adding-new-sensors">
<h1>Adding New Sensors<a class="headerlink" href="#adding-new-sensors" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>In our codebase, sensor integration varies depending on the sensor. Below are examples of sensors that have been tested or integrated and are compatible with our platform:</p>
<ul class="simple">
<li><p><strong>Analog input</strong>
- Force sensitive resistor
- Torque sensor (strain gauge)
- Angle sensor (AS5600; hall effect)</p></li>
<li><p><strong>Bus protocol</strong>
- I2C (Teensy-Nano communication)
- UART (Teensy-Nano communication)
- CAN (Teensy-Motor communication)
- SPI (Teensy-SD Card interface)</p></li>
</ul>
<p>Here, we demonstrate how the Teensy communicates with sensors using an example for an analog input sensor and another for the I2C protocol.</p>
</section>
<hr class="docutils" />
<section id="analog-input">
<h2>Analog Input<a class="headerlink" href="#analog-input" title="Link to this heading"></a></h2>
<p>For an analog sensor—such as the torque sensor used for exoskeleton torque feedback control—the fundamental operation uses <code class="docutils literal notranslate"><span class="pre">analogRead()</span></code> on the sensor’s signal pin to retrieve its value (or an amplified version):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="n">current_reading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">_pin</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">torque_calibration</span><span class="o">::</span><span class="n">AI_CNT_TO_V</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Notes from PJRC:</strong>
- None of the pins on the Teensy are 5-volt tolerant; the input voltage range is fixed at 0 to 3.3 volts.
- <code class="docutils literal notranslate"><span class="pre">analogReference()</span></code> has no effect on the Teensy 4.1.</p>
<p><em>Sidenote:</em>
If you need to use <code class="docutils literal notranslate"><span class="pre">digitalRead()</span></code>, ensure you set the proper pin mode using <code class="docutils literal notranslate"><span class="pre">pinMode()</span></code>, such as <code class="docutils literal notranslate"><span class="pre">INPUT</span></code> or <code class="docutils literal notranslate"><span class="pre">INPUT_PULLUP</span></code>. Refer to the sensor or peripheral user manual for guidance.</p>
<p><strong>More examples on ``analogRead()``:</strong>
The following files utilize <code class="docutils literal notranslate"><span class="pre">analogRead()</span></code>:
- <code class="docutils literal notranslate"><span class="pre">AnkleAngles.cpp</span></code>
- <code class="docutils literal notranslate"><span class="pre">FSR.cpp</span></code>
- <code class="docutils literal notranslate"><span class="pre">TorqueSensor.cpp</span></code></p>
<p><strong>Available Analog Pins:</strong>
If you are using our reference PCB, consult the PCB design documentation for the list of available analog pins. Stacking headers for Teensy 4.1 can also be used to improve access.</p>
</section>
<hr class="docutils" />
<section id="bus-protocols">
<h2>Bus Protocols<a class="headerlink" href="#bus-protocols" title="Link to this heading"></a></h2>
<p>Unlike analog signals, bus protocols provide a highway for digital signals, enabling faster data transmission at higher frequencies.
A comparison of the protocols used in our codebase can be found here:
<a class="reference external" href="https://www.totalphase.com/blog/2021/12/i2c-vs-spi-vs-uart-introduction-and-comparison-similarities-differences/">I2C vs SPI vs UART</a></p>
<p>### I2C in Our Codebase—A Detailed Example
Noah Enlow has put together excellent documentation on I2C in our codebase. Below is a step-by-step example of sending float data over I2C using a union.</p>
<ol class="arabic">
<li><p><strong>Define the Union on the Sending Device</strong>
This union allows you to access the same raw data as a float or as bytes.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">union</span><span class="w"> </span><span class="nc">Data</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">data_as_float</span><span class="p">;</span><span class="w">        </span><span class="c1">// Float representation</span>
<span class="w">    </span><span class="n">byte</span><span class="w"> </span><span class="n">data_as_bytes</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span><span class="w">      </span><span class="c1">// Byte vector (floats are 4 bytes)</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p><strong>Store the Data to Send</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span><span class="p">.</span><span class="n">data_as_float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_to_be_sent</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p><strong>Send Data via I2C Using the Wire Library</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">sendEvent</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">data_as_bytes</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">data_as_bytes</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p><strong>Receiving the Data on the Primary Device</strong></p>
<ol class="arabic">
<li><p>Define an identical union:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">union</span><span class="w"> </span><span class="nc">Data</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">data_as_float</span><span class="p">;</span>
<span class="w">    </span><span class="n">byte</span><span class="w"> </span><span class="n">data_as_bytes</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>Request the data from the peripheral:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Wire</span><span class="p">.</span><span class="n">requestFrom</span><span class="p">(</span><span class="n">PERIPHERAL_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Data</span><span class="p">.</span><span class="n">data_as_bytes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Convert the received bytes back to a float:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="n">data_received</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">data_as_float</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</li>
</ol>
<p>In summary, the process is:</p>
<p>float -&gt; convert to bytes -&gt; send over I2C -&gt; receive as bytes -&gt; convert back to float</p>
<p><strong>More Examples on Bus Protocols:</strong></p>
<ul class="simple">
<li><p>Files using <strong>I2C</strong>:
- <code class="docutils literal notranslate"><span class="pre">Battery.cpp</span></code>
- <code class="docutils literal notranslate"><span class="pre">I2CHandler.h</span></code>
- <code class="docutils literal notranslate"><span class="pre">RealTimeI2C.cpp</span></code>
- <code class="docutils literal notranslate"><span class="pre">ThIMU.h</span></code></p></li>
<li><p>Files using <strong>SPI</strong>:
- <code class="docutils literal notranslate"><span class="pre">ParamsFromSD.cpp</span></code></p></li>
<li><p>Files using <strong>UART</strong>:
- <code class="docutils literal notranslate"><span class="pre">ble_commands.h</span></code>
- <code class="docutils literal notranslate"><span class="pre">ComsMCU.cpp</span></code> and <code class="docutils literal notranslate"><span class="pre">ComsMCU.h</span></code>
- <code class="docutils literal notranslate"><span class="pre">ErrorReporter.h</span></code>
- <code class="docutils literal notranslate"><span class="pre">Exo.cpp</span></code>
- <code class="docutils literal notranslate"><span class="pre">uart_commands.h</span></code>
- <code class="docutils literal notranslate"><span class="pre">UARTHandler.cpp</span></code></p></li>
<li><p>Files using <strong>CAN</strong>:
- <code class="docutils literal notranslate"><span class="pre">CAN.h</span></code>
- <code class="docutils literal notranslate"><span class="pre">Motor.cpp</span></code></p></li>
</ul>
<p><strong>Available Pins for Bus Protocols:</strong>
Check your reference PCB documentation for the list of available pins. Stacking headers on the Teensy 4.1 can also improve access.</p>
</section>
<hr class="docutils" />
<section id="integrating-new-sensors-into-the-codebase">
<h2>Integrating New Sensors into the Codebase<a class="headerlink" href="#integrating-new-sensors-into-the-codebase" title="Link to this heading"></a></h2>
<p>To ensure that sensor readings are accessible across the system, follow these procedures to embed your new sensor.</p>
<p>### Location – Where Should I Write the Sensor Code?
Due to the lack of a common sensor interface, decide where the sensor code best fits within the system architecture (e.g., exo, side, or joint level).</p>
<p>### Create the Sensor
Develop a sensor as its own class by creating corresponding <code class="docutils literal notranslate"><span class="pre">.h</span></code> and <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> files in the <strong>src</strong> folder. Below is an outline for the sensor header file:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CLASS_NAME</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// Constructor: may include a pin parameter if using an analog input</span>
<span class="w">        </span><span class="n">CLASS_NAME</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pin</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Checks if the sensor needs calibration and returns whether calibration is complete</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nf">calibrate</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">do_calibrate</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Reads the sensor and returns its value; for multiple returns, use pointers</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="nf">read</span><span class="p">();</span>

<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// A sample private function (implementation will vary)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">_sample_function</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// The pin to which the sensor is connected</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">_pin</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// A private variable for sensor data (example)</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">_sample_var</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>### Migrating to the Main Code</p>
<p>#### Board.h
For each board that will use the sensor, define the pin(s) that each sensor will use. For analog sensors, define four pins if four sensors are employed (adapt for other types as needed). Ensure that the chosen pin is free; planning your PCB layout beforehand facilitates this.</p>
<p>#### System Containing Sensor Data (.h)
Create variables in the appropriate data-holding class (e.g., <code class="docutils literal notranslate"><span class="pre">SideData</span></code> or <code class="docutils literal notranslate"><span class="pre">JointData</span></code>) to store sensor readings and calibration status. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="n">sensor_reading</span><span class="p">;</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">sensor_calibrate</span><span class="p">;</span>
</pre></div>
</div>
<p>#### System Containing Sensor Data (.cpp)
In the constructor for the corresponding data class, initialize these variables (often to 0 or false):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">sensor_reading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">sensor_calibrate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</pre></div>
</div>
<p>#### System Containing Sensor.h
If the sensor is at the side level, include the sensor header in <code class="docutils literal notranslate"><span class="pre">Side.h</span></code>; if at the joint level, in <code class="docutils literal notranslate"><span class="pre">Joint.h</span></code>. Then, declare an instance of your sensor class:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Sensor.h&quot;</span>
<span class="c1">// Within the class declaration:</span>
<span class="n">SensorClass</span><span class="w"> </span><span class="n">new_instance_of_sensor</span><span class="p">;</span>
</pre></div>
</div>
<p>#### System Containing Sensor.cpp
Within the corresponding <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> file:
1. In the class constructor (using the initializer list), instantiate your sensor object. For example, for a joint level sensor:</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Joint</span><span class="o">::</span><span class="n">Joint</span><span class="p">(</span><span class="n">config_defs</span><span class="o">::</span><span class="n">joint_id</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">config_to_send</span><span class="p">)</span>
<span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="n">motor</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">config_to_send</span><span class="p">)</span>
<span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="n">controller</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">config_to_send</span><span class="p">)</span>
<span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="n">new_instance_of_sensor</span><span class="p">(</span><span class="n">pin_to_use</span><span class="p">)</span><span class="w">  </span><span class="c1">// Initialize the sensor instance</span>
<span class="p">{</span>
<span class="w">   </span><span class="c1">// Other initialization code...</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p>In the method that reads sensor data, call the sensor’s <code class="docutils literal notranslate"><span class="pre">read()</span></code> function to update the system data:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">_joint_data</span><span class="o">-&gt;</span><span class="n">sensor_reading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_instance_of_sensor</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>Similarly, call the sensor’s <code class="docutils literal notranslate"><span class="pre">calibrate()</span></code> method to update the calibration state:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">_joint_data</span><span class="o">-&gt;</span><span class="n">sensor_calibrate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_instance_of_sensor</span><span class="p">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">_joint_data</span><span class="o">-&gt;</span><span class="n">sensor_calibrate</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<p>This ensures that every time the joint (or side) runs, the sensor data is updated and, if needed, calibrated.</p>
<hr class="docutils" />
<p>By following the above steps, you can integrate new sensors into the system. Adjust the code examples as necessary to match the specific requirements of your sensor and target hardware.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="AddingNewMotorType.html" class="btn btn-neutral float-left" title="Adding a New Motor Type" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="AddingNewUARTMessage.html" class="btn btn-neutral float-right" title="Adding New UART Messages" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Landon Coonrod, Jack Williams, and Prof. Zach Lerner.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>